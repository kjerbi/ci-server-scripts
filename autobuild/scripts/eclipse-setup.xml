<project name="Headless Eclipse setup" default="reinstall.eclipse.build">
	
	<!-- Load properties file -->
	<property file="headless-config.properties" />
	
	<target name="clean.eclipse.build">
		<delete dir="${eclipse.build.root}" failonerror="false"/>
	</target>
	
	<target name="clean.eclipse.runtime">
		<delete dir="${eclipse.runtime.root}" failonerror="false"/>
	</target>
	
	<target name="install.eclipse.build">
		<mkdir dir="${eclipse.build.root}"/>
		<exec executable="tar">
			<arg value="-xzaf"/>
			<arg value="${eclipse.archive.path}" />
		</exec>
		<move todir="${eclipse.build.root}">
			<fileset dir="eclipse">
				<include name="**"/>
			</fileset>
		</move>
		<delete dir="eclipse"/>
		
		<exec executable="${eclipse.build.root}/eclipse" failonerror="true" dir="${eclipse.build.root}">
			<arg value="-nosplash" />
			<arg value="-consoleLog" />
			<arg value="-application" />
			<arg value="org.eclipse.equinox.p2.director" />
			
			<arg value="-destination" />
			<arg value="${eclipse.build.root}" />
			<arg value="-repository" />
			<arg value="${eclipse.build.repos}" />
			
			<arg value="-followReferences" />
			<arg value="-installIU" />
			<arg value="${eclipse.build.dependencies}" />
		</exec>
	</target>
	
	<target name="install.eclipse.runtime">
		<mkdir dir="${eclipse.runtime.root}"/>
		<exec executable="tar">
			<arg value="-xzaf"/>
			<arg value="${eclipse.archive.path}" />
		</exec>
		<move todir="${eclipse.runtime.root}">
			<fileset dir="eclipse">
				<include name="**"/>
			</fileset>
		</move>
		<delete dir="eclipse"/>
	</target>
	
	<target name="reinstall.eclipse.build" depends="clean.eclipse.build, install.eclipse.build" />
	<target name="reinstall.eclipse.runtime" depends="clean.eclipse.runtime, install.eclipse.runtime" />

</project>